<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>{{title}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="/stylesheets/style.css" />
  <link rel="stylesheet" href="/stylesheets/auth.css" />
  <link rel="stylesheet" href="/stylesheets/header.css" />
  <link rel="stylesheet" href="/stylesheets/mangainfo.css" />
  <link rel="stylesheet" href="/stylesheets/footer.css" />

</head>

<body>
  {{!-- MANGA INFOS --}}
  {{> header}}
  <section class="manga-detail">
    <div class="wrapper-manga-info">
      <div class="wrapper-img">
        <img class="manga-info" src={{mangainfo.image_url}} />
      </div>
      <div class="wrapper-info">
        {{#if mangainfo.title_english}}
        <h1>{{mangainfo.title_english}}</h1>
        {{else}}
        <h1>{{mangainfo.title}}</h1>
        {{/if}}
        <p>{{mangainfo.synopsis}}</p>
        <h3>Volume Info</h3>
        <p>Favorites: {{mangainfo.favorites}}</p>
        <p>Readers' note: {{mangainfo.score}}/10</p>
        {{#if mangainfo.volumes}}
        <p>Volumes : {{mangainfo.volumes}}</p>
        {{/if}}
        <p>Number of episodes: : {{mangainfo.episodes}}</p>
        <p>Genres:
          {{#each mangainfo.genres}}
          {{name}}
          {{/each}}</p>
      </div>
    </div>
    {{#if mangainfo.trailer_url}}
    <h2>Watch the trailer!</h2>
    <iframe width="560" height="315" src="{{mangainfo.trailer_url}}">
    </iframe>
    {{/if}}
  </section>


  {{!-- REVIEWS --}}
  <section id="reviews">
    <h1>Reviews</h1>
    {{#if reviews.reviews}}
    <div class="section-review">
      {{#each reviews.reviews}}
      <div class="reviews-box-container">
        <div class="reviews-box">
          <div class="box-top">
            <div class="profile">
              <div class="name-user">
                <div class="user-image">
                  <img src="{{reviewer.image_url}}" alt="{{reviewer.username}} image" class="user-img">
                </div>
                <h3> {{reviewer.username}}</h3>
                <h5>rated it <img src="/images/star-score.svg" alt="star score" height="20">
                  {{reviewer.scores.overall}}</h5>
                  <div class="score-review">
                <p>story: {{reviewer.scores.story}}/10</p>
                <p>art: {{reviewer.scores.art}}/10</p>
                <p>character: {{reviewer.scores.character}}/10</p>
                <p>enjoyment: {{reviewer.scores.enjoyment}}/10</p>
</div>

                <br>

              </div>
            </div>
            <div class="review-text module line-clamp" style="max-width: 800px">
              {{content}}
            </div>
            <input type="checkbox" id="btn-modal">
            <label for="btn-modal" class="lbl-modal">Read More</label>
            <div class="modal">
              <div class="container">
                <label for="btn-modal">CLOSE</label>
                <div class="content">
                  <h3>Review from {{reviewer.username}} </h3>
                  <div>{{content}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {{/each}}
      {{else}}
      <p class="">There is no review yet! Be first to share your opinion on this manga!</p>
      {{/if}}
    </div>
  </section>

  {{!-- ADD A REVIEW --}}
  <section id="add-review">
    <h1>Add a review</h1>
    {{#if userInSession}}
    <form id="review-form" action="/" method="POST">
      <textarea class="form-txt" type="text" placeholder="What did you think of the manga?" aria-label="Review"
        name="review"></textarea>
    </form>
    <button class="btn-submit" type="submit">
      Submit
    </button>
    </div>
    {{else}}
    <p>You must have an account to leave a review</p>
    <button class="login-btn"><a href="/auth/login">Log In</a></button>
    <button class="sign-btn"><a href="/auth/signup">Sign in</a></button>

    {{/if}}
  </section>
  {{> footer}}

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
    integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
    integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
    crossorigin="anonymous"></script>
</body>

</html>

<script>
  function handleCredentialResponse(response) {
    console.log(response.credential)
    const data = { id_token: response.credential };
    const url = 'http://localhost:3000/auth/loginggoogle'

    fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
      .then(resp => {
        window.open(resp.url, '_self');
      })
      .then(data => console.log('Nuestro server', data))
      .catch(console.log);
  }
</script>