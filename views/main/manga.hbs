<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>{{title}}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <link rel="stylesheet" href="/stylesheets/auth/style.css" />
  <link rel="stylesheet" href="/stylesheets/navbar/style.css" />
  <link rel="stylesheet" href="/stylesheets/mangainfo/style.css" />
  <link rel="stylesheet" href="/stylesheets/style.css" />


</head>

<body>
  {{!-- MANGA INFOS --}}
  {{> header}}
  <section class="manga-detail">
    <div class="wrapper-manga-info">
      <div class="wrapper-img">
        <img class="manga-info" src={{mangainfo.image_url}} />
      </div>
      <div class="wrapper-info">
        <h1>{{mangainfo.title}}</h1>
        <p>{{mangainfo.synopsis}}</p>
        <p>Favorites: {{mangainfo.favorites}}</p>
        <p>Readers' note: {{mangainfo.score}}</p>
        <p>Genres: </p>

      </div>
    </div>

    {{!-- REVIEWS --}}
    <section id="reviews">
      <h1>Reviews</h1>
      {{#if reviews.reviews}}
      <div class="section-review">
        {{#each reviews.reviews}}
        <div class="reviews-box-container">
          <div class="reviews-box">
            <div class="box-top">
              <div class="profile">
                <div class="name-user">

                  <h2> {{reviewer.username}}</h2>
                  <h5>rated it <img src="/images/star-score.svg" alt="star score" height="20">
                    {{reviewer.scores.overall}}</h5>
                  <br>
                  {{date}}
                </div>
              </div>
              <div class="review-text module line-clamp" style="max-width: 800px">
                {{content}}
                <br>
                <br>
              </div>
              <input type="checkbox" id="btn-modal">
              <label for="btn-modal" class="lbl-modal">Read More</label>
              <div class="modal">
                <div class="contenedor">
                  <label for="btn-modal">CLOSE</label>
                  <div class="contenido">
                    <h3>Review from {{reviewer.username}} </h3>
                    <div>{{content}}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {{/each}}
          {{else}}
          <p class="">There is no review yet! Be first to share your opinion on this manga!</p>
          {{/if}}
        </div>
    </section>

    {{!-- ADD A REVIEW --}}
    <section id="add-review">
      <h1>Add a review</h1>
      {{#if access}}
      <form id="review-form" action="/" method="POST">
        <textarea class="form-txt" type="text" placeholder="What did you think of the manga?" aria-label="Review"
          name="review"></textarea>
      </form>
      <button class="btn-submit" type="submit">
        Submit
      </button>
      </div>
      {{else}}
      <p>You must have an account to leave a review</p>
      <button class="login-btn"><a href="/auth/login">Log In</a></button>
        <button class="sign-btn"><a href="/auth/signup">Sign in</a></button>

      {{/if}}
    </section>
    {{> footer}}

    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"
      integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13"
      crossorigin="anonymous"></script>
</body>

</html>

<script>
  function handleCredentialResponse(response) {
    console.log(response.credential)
    const data = { id_token: response.credential };
    const url = 'http://localhost:3000/auth/loginggoogle'

    fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    })
      .then(resp => {
        window.open(resp.url, '_self');
      })
      .then(data => console.log('Nuestro server', data))
      .catch(console.log);
  }
</script>